spring:
  application:
    name: trading-app

  datasource:
    url: jdbc:mysql://localhost:3306/trading
    username: myuser
    password: Esoft@1234
    driver-class-name: com.mysql.cj.jdbc.Driver
    # --- Database Pool Tuning ---
    # We set this to 30 to handle: 5 Quartz Threads + 25 Web Requests
    hikari:
      maximum-pool-size: 30
      minimum-idle: 5
      idle-timeout: 30000
      connection-timeout: 20000
      max-lifetime: 1800000

  flyway:
    enabled: true
    baseline-on-migrate: true
    baseline-version: 6

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    open-in-view: false # Important for performance
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect

  # Quartz Configuration
  quartz:
    job-store-type: jdbc
    properties:
      org:
        quartz:
          jobStore:
            class: org.springframework.scheduling.quartz.LocalDataSourceJobStore
            driverDelegateClass: org.quartz.impl.jdbcjobstore.StdJDBCDelegate
            tablePrefix: QRTZ_
            isClustered: true
            clusterCheckinInterval: 5000
          threadPool:
            class: org.quartz.simpl.SimpleThreadPool
            threadCount: 5 # Reduced to 5 to leave room for web users
            threadPriority: 5

# -------- Broker Configurations ---------
broker:
  dhan:
    base-url: https://api.dhan.co
    # These are placeholders, validation uses what's passed from UI
    api-key: ${DHAN_API_KEY}

    # Dhan Official Endpoints
    auth-path: /fund-limits  # Used for validation check
    place-order-path: /orders
    order-status-path: /orders
    cancel-order-path: /orders

  fyers:
    base-url: https://api.fyers.in
    api-key: ${FYERS_API_KEY}
    secret-key: ${FYERS_SECRET}
    redirect-url: http://localhost:8080/auth/callback
    auth-path: /api/v2/generate-token
    place-order-path: /api/v2/orders
    order-status-path: /api/v2/orders/status
    cancel-order-path: /api/v2/orders/cancel

  angelone:
    base-url: https://apiconnect.angelone.in  # <--- UPDATED DOMAIN

    # Credentials (placeholders)
    client-id: ${ANGEL_CLIENT_ID}
    client-secret: ${ANGEL_CLIENT_SECRET}
    api-key: ${ANGEL_API_KEY}

    # Paths (These match the documentation you shared)
    auth-path: /rest/auth/angelbroking/user/v1/loginByPassword
    place-order-path: /rest/secure/angelbroking/order/v1/placeOrder
    order-status-path: /rest/secure/angelbroking/order/v1/details
    cancel-order-path: /rest/secure/angelbroking/order/v1/cancelOrder

app:
  jwt:
    # Use environment variable or default for dev
    secret: ${APP_JWT_SECRET:ThisIsAVeryLongSecretKeyThatIsAtLeast32BytesLongForSecurityRequirements12345}
    ttl-seconds: 3600
  crypto:
    key: "9X5xG8/3zLq+1WdE4r6u7i8oP0tH2kL5vN9mJ3j4f6A="

logging:
  level:
    org.springframework.web.reactive.function.client.ExchangeFunctions: TRACE
    org.springframework.security: DEBUG